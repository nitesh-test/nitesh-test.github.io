<script>
  const WHATSAPP_NO = "919110905833"; // your number with country code

  document.getElementById('booking-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const data = new FormData(form);

    const name = data.get('name');
    const cls = data.get('class');
    const subject = data.get('subject');
    const phone = data.get('phone');

    const message = `New Booking Request:
Name: ${name}
Class: ${cls}
Subject: ${subject}
Phone: ${phone}`;

    const emailPayload = {
      name, class: cls, subject, phone,
      _subject: `New booking request ${phone}`
    };

    try {
      const emailRes = await fetch('https://formsubmit.co/ajax/padhado@gmail.com', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify(emailPayload)
      });

      if (emailRes.ok) {
        // Google Ads Conversion Event
        gtag('event', 'conversion', {
          'send_to': 'AW-17892433804/BOOKING_LABEL'
        });

        showToast('Redirecting to WhatsApp...');

        // Open WhatsApp with prefilled message
        const waUrl = `https://wa.me/${WHATSAPP_NO}?text=${encodeURIComponent(message)}`;
        setTimeout(() => {
          window.location.href = waUrl;
          form.reset();
        }, 800);

      } else {
        showToast('Failed to send booking.');
      }
    } catch {
      showToast('Failed to send booking.');
    }
  });

  function showToast(message) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.classList.add('show');
    setTimeout(() => {
      toast.classList.remove('show');
    }, 3000);
  }

  document.getElementById('y').textContent = new Date().getFullYear();
</script>
